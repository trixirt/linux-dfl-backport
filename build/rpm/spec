Name:               linux-dfl-backport
Version:            %{getenv:BACKPORT_VERSION}
Release:            1
Summary:            Backported kernel modules for in-development linux fpga dfl modules
License:            GPLv2+
Group:              System/Kernel and hardware
URL:                https://github.com/OPAE/linux-dfl/
BuildArch:          noarch
Requires:           dkms, (kernel-devel if kernel), (kernel-rt-devel-uname-r if kernel-rt)

%define _dstdir %{_usrsrc}/linux-dfl-backport-%{version}-%{release}
%define _pkgdir %{buildroot}%{_dstdir}

%description
Device Feature List (dfl) is used by FPGAs to communicate features
supported by a given loaded firmware/bitstream. Since dfl support in the
Linux kernel has yet to materialize, this package contains a backported
version of the current dfl support.

%install
install -d %{_pkgdir}
cp -a build/dkms/dkms.conf Makefile drivers include %{_pkgdir}

%post
dkms add %{name}/%{version}-%{release} --rpm_safe_upgrade
dkms install %{name}/%{version}-%{release} --rpm_safe_upgrade

%preun
dkms remove %{name}/%{version}-%{release} --rpm_safe_upgrade --all

%postun
rmdir %{_dstdir} %{_regmapdstdir}

%files
%defattr(-,root,root)
%{_dstdir}/*
